openapi: 3.0.1
info:
  title: API ENERGISA
  description: |-
    **Authentication overview (two layers)**

    1) **Gateway (Sensedia) – OAuth Client Credentials**
       - Faça `POST /oauth/access-token` enviando **apenas** os headers:
         - `Authorization: Basic base64(client_id:client_secret)`
         - `Content-Type: application/x-www-form-urlencoded`
       - No corpo, envie `grant_type=client_credentials` (valor fixo).
       - O `access_token` retornado deve ser incluído no header `access_token` de **todas** as chamadas seguintes (inclusive no endpoint de Empresa Parceira).

    2) **Aplicação – Autenticação da Empresa Parceira**
       - Após obter o OAuth access token, chame `/autenticacao/{version}/UsuarioEmpresaParceira` enviando:
         - Headers (camada Sensedia): `client_id` e `access_token` (obtido em `/oauth/access-token`).
         - Body (credenciais do parceiro): `tokenAcessoApi` (usuário) e `senhaAcessoApi` (senha).
       - A resposta 200 retorna o **Partner Company Token** em `objeto.accessToken`, além de `refreshToken`, `prazoExpiracao` e `tipoAutenticacao`.
       - O Partner Company Token deve ser enviado nos endpoints que exigem autenticação de parceiro no header:
         - `Authorization: Bearer <PartnerCompanyToken>`

    - O header `client_id` é obrigatório em todas as chamadas (exceto `/oauth/access-token`), para identificar a aplicação integrada.
    - O header `access_token` (OAuth token) é obrigatório em todas as chamadas, exceto no próprio `/oauth/access-token`.
    - O Partner Company Token é obrigatório apenas nos endpoints que fazem autenticação de parceiro.
    - O endpoints `POST /clientes/{version}/pre-payment/qrcode` e `POST /clientes/{version}/pre-payment/{CompanyId}/payments/{RechargeId}/status`   **não** exigem o Partner Company Token — apenas os headers `client_id` e `access_token`.

  version: 1.2.0
tags:
  - name: Autenticação
  - name: Faturamento
  - name: Atendimento
paths:
  /oauth/access-token:
    post:
      summary: Obter token de acesso OAuth
      deprecated: false
      description: |-
        Endpoint para autenticação e obtenção do access token utilizando o fluxo **OAuth 2.0 Client Credentials**.

        **Headers obrigatórios:**
        - `Authorization: Basic base64(client_id:client_secret)`
        - `Content-Type: application/x-www-form-urlencoded`

        **Body (x-www-form-urlencoded):**
        - `grant_type=client_credentials` (valor fixo)

        O token deve ser enviado no header `access_token` das demais requisições como: `{access_token}`.
      tags:
        - Autenticação

      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - grant_type
              properties:
                grant_type:
                  type: string
                  description: Tipo de concessão OAuth. Deve ser 'client_credentials'
                  enum:
                    - client_credentials
                  example: client_credentials
      responses:
        "200":
          description: Token gerado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    description: Token de acesso a ser utilizado nas requisições
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  token_type:
                    type: string
                    description: Tipo do token
                    example: Bearer
                  expires_in:
                    type: integer
                    description: Tempo de expiração do token em segundos
                    example: 3600
                  scope:
                    type: string
                    description: Escopos concedidos ao token
                    example: read write
        "400":
          description: Requisição inválida
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                InvalidGrantType:
                  summary: Grant type inválido
                  value:
                    error:
                      code: INVALID_GRANT_TYPE
                      message: Grant type inválido
                      detail: O grant_type deve ser 'client_credentials'
                      timestamp: "2025-10-06T14:30:00Z"
                      retryable: false
        "401":
          description: Credenciais inválidas
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                InvalidCredentials:
                  summary: Credenciais inválidas
                  value:
                    error:
                      code: INVALID_CREDENTIALS
                      message: Credenciais inválidas
                      detail: client_id ou client_secret fornecidos no header Authorization (Basic) são inválidos
                      timestamp: "2025-10-06T14:30:00Z"
                      retryable: false
                MissingAuthorization:
                  summary: Header Authorization ausente
                  value:
                    error:
                      code: MISSING_AUTHORIZATION
                      message: Header Authorization ausente
                      detail: O header Authorization com as credenciais Basic base64(client_id:client_secret) é obrigatório
                      timestamp: "2025-10-06T14:30:00Z"
                      retryable: false
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - BasicAuth: []

  "/autenticacao/{version}/UsuarioEmpresaParceira":
    post:
      summary: Realiza a autenticação de clientes externos da API
      deprecated: false
      tags:
        - Autenticação
      description: |-
        Autentica a **Empresa Parceira** na aplicação.

        **Requisitos:**
        - Headers (camada Sensedia): `client_id` e `access_token` (obtido em `/oauth/access-token`).
        - Body (credenciais do parceiro): `tokenAcessoApi` (usuário) e `senhaAcessoApi` (senha).

        **Retorno 200:** contém o Partner Company Token em `objeto.accessToken`, além de `refreshToken`, `prazoExpiracao` e `tipoAutenticacao`.
      parameters:
        - $ref: "#/components/parameters/VersionPathParam"
        - $ref: "#/components/parameters/AuthClientId"
        - $ref: "#/components/parameters/AuthAccessToken"
      requestBody:
        description: Objeto contendo credenciais (token de acesso e senha de acesso)
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CredenciaisUsuarioEmpresaParceiraApi"
            examples:
              exemploValido:
                summary: Exemplo de body válido
                value:
                  tokenAcessoApi: "parceiro.hexing"
                  senhaAcessoApi: "S3nh@Segura!"
          application/json-patch+json:
            schema:
              $ref: "#/components/schemas/CredenciaisUsuarioEmpresaParceiraApi"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerCompanyAuthResponse"
              examples:
                sucesso:
                  summary: Exemplo de retorno com Partner Company Token
                  value:
                    objeto:
                      accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      refreshToken: "18e5732fd15...c40d82"
                      prazoExpiracao: 1762903696
                      tipoAutenticacao: "Empresa Parceira"
                    codigo: "OK"
                    mensagem: "Acesso autorizado."
                    categoria: "OK"
        "400":
          description: Requisição inválida.
        "403":
          description: Forbidden (credenciais do parceiro inválidas)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                usuarioInexistente:
                  summary: Usuário inexistente
                  value:
                    error:
                      code: "FORBIDDEN"
                      message: "Usuário inexistente."
                      detail: "As credenciais tokenAcessoApi/senhaAcessoApi não foram reconhecidas."
                      timestamp: "2025-10-06T14:30:00Z"
                      retryable: false
        "412":
          description: Erro de validação de parâmetros de entrada.
        "500":
          description: Ocorreu um erro inesperado.

  /clientes/{version}/pre-payment/qrcode:
    post:
      summary: Request Pix QrCode for recharge payment
      deprecated: false
      description: |-
        This endpoint allows the requester to obtain a Pix QRCode for making a recharge payment to a specific meter.
      tags:
        - Faturamento
      parameters:
        - $ref: "#/components/parameters/VersionPathParam"
        - $ref: "#/components/parameters/AuthClientId"
        - $ref: "#/components/parameters/AuthAccessToken"
      requestBody:
        content:
          application/json:
            schema:
              required:
                - companyId
                - meterNumber
                - requestedValue
                - uc
                - rechargeId
              type: object
              properties:
                companyId:
                  $ref: "#/components/schemas/CompanyId"
                  example: EMR
                meterNumber:
                  type: string
                  description: Meter number
                  example: 123456
                uc:
                  type: string
                  description: Energisa Customer Identifier (Consumer Unit)
                  example: "987654321"
                requestedValue:
                  type: number
                  description: Requested recharge value
                  format: decimal
                  example: 100.75
                rechargeId:
                  type: string
                  description: Recharge Identifier generated by the requester
                  example: 3f2504e0-4f89-41d3-9a0c-0305e82c3301
                qrCodeImageSize:
                  type: integer
                  format: int32
                  minimum: 50
                  maximum: 512
                  description: Image size in pixels (between 50 and 512)
                  example: 256
            examples: {}
      responses:
        "200":
          description: QRCode generate successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  rechargeId:
                    type: string
                    description: Recharge Identifier generated by the requester
                    example: 3f2504e0-4f89-41d3-9a0c-0305e82c3301
                  txQrCode:
                    type: string
                    description: EMV QRCode pix
                    example: 00020126580014br.gov.bcb.pix...
                  base64QrCode:
                    type: string
                    description: EMV QRCode pix image in base64
                    example: kwhbefkhwbkefbwkefbkwefwef...
                  paymentValue:
                    type: number
                    description: paymentValue = requestedValue - cashbackValue
                    format: decimal
                    example: 100.75
                  exceedValue:
                    type: number
                    description: Excess balance recharge value
                    format: decimal
                    example: 10
                  cashbackValue:
                    type: number
                    description: cashbackValue is controlled by Energisa. This value originates from the last billing, in cases where the customer's bill amount was lower than the recharge amount. Thus, when ORCA requests the generation of the QRCode, Energisa will verify if cashback is available. If it exists, the amount will be deducted from requestedValue.
                    format: decimal
                    example: 10
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFoundQRCode"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /clientes/{version}/pre-payment/{CompanyId}/payments/{RechargeId}/status:
    post:
      summary: Returns the payment status of a recharge
      tags:
        - Faturamento
      parameters:
        - $ref: "#/components/parameters/CompanyId"
        - name: RechargeId
          in: path
          required: true
          description: Recharge ID
          schema:
            type: string
            format: uuid
        - $ref: "#/components/parameters/VersionPathParam"
        - $ref: "#/components/parameters/AuthClientId"
        - $ref: "#/components/parameters/AuthAccessToken"
      description: ""
      responses:
        "200":
          description: Status returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum:
                      - PENDING
                      - CONFIRMED
                      - EXPIRED
                      - UNKNOWN
                  paymentDateTime:
                    type: string
                    format: date-time
        "404":
          description: Recharge not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        description: Error code identifier
                        example: RECHARGE_NOT_FOUND
                      message:
                        type: string
                        description: Human-readable error message
                        example: Recarga não encontrada
                      detail:
                        type: string
                        description: Detailed error description
                        example: Recarga não encontrada
                      timestamp:
                        type: string
                        format: date-time
                        description: Error timestamp in ISO 8601 format
                        example: "2025-10-06T14:30:00Z"
                      retryable:
                        type: boolean
                        description: Indicates if the request can be retried
                        example: false
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /clientes/{version}/pre-payment/notification/low-balance:
    post:
      summary: Notify the alerts related to Pre-Payment Customer Balance
      deprecated: false
      description: |-
        This endpoint allows the vending system to notify Energisa about low-balance alerts for pre-payment customers. The alerts can be of different levels (level1, level2, level3) or indicate that the balance is exhausted.

        Upon receiving a low-balance alert, Energisa may take actions such as sending SMS notifications to the customer or updating internal records.
      tags:
        - Atendimento
      parameters:
        - $ref: "#/components/parameters/VersionPathParam"
        - $ref: "#/components/parameters/AuthClientId"
        - $ref: "#/components/parameters/AuthAccessToken"
      requestBody:
        content:
          application/json:
            schema:
              required:
                - companyId
                - meterNumber
                - alertType
                - tresholdValue
                - timestamp
              type: object
              properties:
                companyId:
                  $ref: "#/components/schemas/CompanyId"
                  description: Company that owns the meter
                  example: EMR
                meterNumber:
                  type: string
                  example: 123456
                alertType:
                  type: string
                  description: Alert Type
                  enum:
                    - level1
                    - level2
                    - level3
                    - exhausted
                  example: level1
                tresholdValue:
                  type: number
                  format: decimal
                  description: Threshold Value that triggered the alert
                  example: 20
                timestamp:
                  type: integer
                  description: A timestamp that represents the time when a low-balance event occurred
                  format: long
          examples: {}
      responses:
        "200":
          description: Notification successfully registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success detail
                    example: Notification successfully registered.
                  correlationId:
                    type: string
                    description: Correlation id registered in the notification (just for checking if necessary)
                    example: 3f2504e0-4f89-41d3-9a0c-0305e82c3301
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "504":
          $ref: "#/components/responses/GatewayTimeout"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - BearerAuth: []

  /clientes/{version}/pre-payment/session/{uuid}:
    get:
      summary: Validade unique session key and return linked customer data
      deprecated: false
      description: |-
        This endpoint validates a unique temporary session key (UUID) and returns the associated customer data if the session is valid.

        The UUID is typically generated during the initial interaction with the vending system and is used to securely link the customer's session to their data.

        If the UUID is valid and corresponds to an active session, the endpoint will return relevant customer information such as meter number, name, address, and other details necessary for further interactions.

        If the UUID is invalid, expired, or does not correspond to any active session, appropriate error responses will be returned.

        O campo `session.originChannel` informa o canal de origem:
        - AD = Agência Digital (Web)
        - EON = Aplicativo EON (Mobile)
        - SIATT = Canais Convencionais
      tags:
        - Atendimento
      parameters:
        - $ref: "#/components/parameters/VersionPathParam"
        - $ref: "#/components/parameters/AuthClientId"
        - $ref: "#/components/parameters/AuthAccessToken"
        - name: uuid
          in: path
          description: Unique temporary session key
          required: true
          example: ""
          schema:
            type: string
      responses:
        "200":
          description: Valid session and return linked customer data
          content:
            application/json:
              schema:
                type: object
                properties:
                  session:
                    type: object
                    properties:
                      meterNumber:
                        type: string
                        example: "123456"
                      name:
                        description: Used to display on the page
                        type: string
                        example: João da Silva
                      address:
                        description: Used to display on the page
                        type: string
                        example: Rua Exemplo, 123
                      checkDigit:
                        description: Used to open a protocol
                        type: number
                        example: 5
                      cdc:
                        description: Used to open a protocol
                        type: string
                        example: 1223344
                      cdcAneel:
                        description: Used to display on the page
                        type: string
                        example: 36.247.050-54
                      webCompanyCode:
                        description: Used to open a protocol
                        type: number
                        example: 1
                      originChannel:
                        $ref: "#/components/schemas/OriginChannelType"
                        description: Used to open a protocol
                        example: AD
                      InteractionType:
                        description: Used to open a protocol
                        type: number
                        example: 120
                      ActionCode:
                        description: Used to open a protocol
                        type: number
                        example: 150
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - BearerAuth: []

  /clientes/{version}/pre-payment/notification/recharge-status:
    post:
      summary: Notify the result of the recharge issuance to the meter
      deprecated: false
      description: |-
        After the vending system issues the token to the meter, it waits for the meter's communication result. Once vending receives the result, it returns it to Energisa.

        This endpoint allows the vending system to notify Energisa about the result of a recharge issuance to a specific meter. The notification includes details such as whether the recharge was successful, the amount of energy (in kWh) credited, and any tokens issued.
      tags:
        - Atendimento
      parameters:
        - $ref: "#/components/parameters/VersionPathParam"
        - $ref: "#/components/parameters/AuthClientId"
        - $ref: "#/components/parameters/AuthAccessToken"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                rechargeStatus:
                  type: boolean
                  description: Recharge to Meter Status
                msg:
                  type: string
                msgId:
                  type: string
                  description: Same as QRCode interface
                  example: 3F2504E0-4F89-11D3-9A0C-0305E82C3301
                meterNumber:
                  type: string
                  description: Meter number
                  example: "123456789"
                units:
                  type: number
                  description: kWh
                  example: 115
                tokens:
                  type: string
                  description: If the issuance fails, the user can input the token through CIU
                  example: "783929502001239345673"
              required:
                - rechargeStatus
                - units
                - meterNumber
                - tokens
          examples: {}
      responses:
        "200":
          description: Recharge successfully completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success detail
                    example: Notification successfully registered.
                  correlationId:
                    type: string
                    description: Correlation id registered in the notification (just for checking if necessary)
                    example: 3f2504e0-4f89-41d3-9a0c-0305e82c3301
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "504":
          $ref: "#/components/responses/GatewayTimeout"
        "500":
          $ref: "#/components/responses/InternalServerError"
      security:
        - BearerAuth: []

  "/clientes/{version}/Atendimento/{CodigoEmpresaWeb}/{Cdc}/{DigitoVerificador}/{TipoInteracao}/{CodigoAcao}":
    get:
      summary: Generate customer service protocol
      deprecated: false
      description: |-
        Generate a customer service protocol.
        This endpoint allows the creation of a customer service protocol based on the provided parameters, including company code, customer identifier (CDC), interaction type, and action code.
      security:
        - BearerAuth: []
      tags:
        - Atendimento
      parameters:
        - $ref: "#/components/parameters/VersionPathParam"
        - $ref: "#/components/parameters/AuthClientId"
        - $ref: "#/components/parameters/AuthAccessToken"
        - name: CodigoEmpresaWeb
          in: path
          required: true
          description: Empresa que consta o numero de cdc.
          schema:
            type: integer
            format: int32
        - name: Cdc
          in: path
          required: true
          description: Parte principal da identificação da UC.
          schema:
            type: integer
            format: int64
        - name: DigitoVerificador
          in: path
          required: true
          description: Dígito verificador da UC.
          schema:
            type: integer
            format: int32
        - name: TipoInteracao
          in: path
          required: true
          description: Tipo da interação a ser solicitada.
          schema:
            type: integer
            format: int32
        - name: CodigoAcao
          in: path
          required: true
          description: Ação informada para abertura do protocolo.
          schema:
            type: integer
            format: int32
      responses:
        "200":
          description: "OK: Interação registrada com sucesso."
          content:
            text/plain:
              schema:
                $ref: "#/components/schemas/RetornoProtocoloResultadoObjeto"
        "400":
          description: "Requisição inválida."
        "401":
          description: Acesso não autorizado.
        "403":
          description: Usuário não autenticado.
        "405":
          description: WebService desabilitado
        "412":
          description: "ERRO: Não foi possível gerar a interação."
        "500":
          description: "Ocorreu um erro inesperado."

components:
  schemas:
    CompanyId:
      type: string
      description: Energisa Company Identifier
      enum: [EMR, ESE, EPB, ETO, EMT, EMS, ESS, EAC, ERO]
    PartnerCompanyAuthResponse:
      type: object
      properties:
        objeto:
          type: object
          properties:
            accessToken:
              type: string
              description: "Partner Company Token (usar em Authorization: Bearer <token>)"
            refreshToken:
              type: string
              description: Token de renovação do Partner Company Token
            prazoExpiracao:
              type: integer
              format: int64
              description: Epoch seconds de expiração do Partner Company Token
            tipoAutenticacao:
              type: string
              description: 'Tipo de autenticação retornada (ex.: "Empresa Parceira")'
        codigo:
          type: string
          example: "OK"
        mensagem:
          type: string
          example: "Acesso autorizado."
        categoria:
          type: string
          example: "OK"
    OriginChannelType:
      type: string
      description: Channel from which the page was accessed.
      enum: [AD, EON, SIATT]
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code identifier
              example: METER_NOT_REGISTERED
            message:
              type: string
              description: Human-readable error message
              example: Medidor não está registrado na base da Energisa
            detail:
              type: string
              description: Detailed error description
              example: O medidor 123456 não foi encontrado na base de dados da empresa EMR
            timestamp:
              type: string
              format: date-time
              description: Error timestamp in ISO 8601 format
              example: "2025-10-06T14:30:00Z"
            retryable:
              type: boolean
              description: Indicates if the request can be retried
              example: false
    RetornoProtocoloResultadoObjeto:
      type: object
      properties:
        objeto:
          type: object
          properties:
            protocoloAtendimento:
              type: integer
              format: int64
              example: 9559495981
        codigo:
          type: string
          example: "OK"
        mensagem:
          type: string
          example: "Interação registrado com sucesso."
        categoria:
          type: string
          example: "OK"
    CredenciaisUsuarioEmpresaParceiraApi:
      type: object
      properties:
        tokenAcessoApi:
          type: string
          nullable: true
        senhaAcessoApi:
          type: string
          nullable: true

  responses:
    BadRequest:
      description: Bad Request. The request could not be understood or was missing required parameters.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            InvalidParameter:
              summary: Missing or invalid parameter
              value:
                error:
                  code: INVALID_PARAMETER
                  message: Parâmetro obrigatório ausente ou inválido
                  detail: O campo 'meterNumber' é obrigatório
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            InvalidMeterNumber:
              summary: Invalid meter number format
              value:
                error:
                  code: INVALID_METER_NUMBER
                  message: Número de medidor inválido
                  detail: O formato do número do medidor está incorreto
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            InvalidCompanyId:
              summary: Invalid company identifier
              value:
                error:
                  code: INVALID_COMPANY_ID
                  message: Company ID inválido
                  detail: O Company ID fornecido não é válido
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            InvalidAlertType:
              summary: Invalid alert type (low-balance endpoint)
              value:
                error:
                  code: INVALID_ALERT_TYPE
                  message: Tipo de alerta inválido
                  detail: O tipo de alerta deve ser um dos seguintes - level1, level2, level3, exhausted
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            InvalidThresholdValue:
              summary: Invalid threshold value (low-balance endpoint)
              value:
                error:
                  code: INVALID_THRESHOLD_VALUE
                  message: Valor de threshold inválido
                  detail: O valor de threshold deve ser um número positivo
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            InvalidRechargeId:
              summary: Invalid recharge ID (recharge-status endpoint)
              value:
                error:
                  code: INVALID_RECHARGE_ID
                  message: ID de recarga inválido
                  detail: O msgId fornecido não possui um formato válido
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            InvalidUnits:
              summary: Invalid units value (recharge-status endpoint)
              value:
                error:
                  code: INVALID_UNITS
                  message: Valor de unidades (kWh) inválido
                  detail: O valor de unidades deve ser um número positivo
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            InvalidTokenFormat:
              summary: Invalid token format (recharge-status endpoint)
              value:
                error:
                  code: INVALID_TOKEN_FORMAT
                  message: Formato de token inválido
                  detail: O formato do token não corresponde ao padrão esperado
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            InvalidUuidFormat:
              summary: Invalid UUID format (session endpoint)
              value:
                error:
                  code: INVALID_UUID_FORMAT
                  message: Formato de UUID inválido
                  detail: O UUID fornecido não está no formato válido. Esperado - formato UUID v4
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
    Unauthorized:
      description: Unauthorized - authentication is required or has failed
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            MissingAuth:
              summary: Missing authentication credentials
              value:
                error:
                  code: MISSING_AUTHENTICATION
                  message: Autenticação não fornecida
                  detail: As credenciais de autenticação são obrigatórias para acessar este endpoint
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            InvalidToken:
              summary: Invalid authentication token
              value:
                error:
                  code: INVALID_TOKEN
                  message: Token de autenticação inválido
                  detail: O token fornecido não é válido ou está mal formatado
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            ExpiredToken:
              summary: Expired authentication token
              value:
                error:
                  code: EXPIRED_TOKEN
                  message: Token de autenticação expirado
                  detail: O token de autenticação expirou e precisa ser renovado
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            InsufficientPermissions:
              summary: Insufficient permissions
              value:
                error:
                  code: INSUFFICIENT_PERMISSIONS
                  message: Permissões insuficientes
                  detail: O usuário autenticado não possui permissões para acessar este recurso
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
    NotFoundQRCode:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            MeterNotRegistered:
              summary: Meter not registered in Energisa database
              value:
                error:
                  code: METER_NOT_REGISTERED
                  message: Medidor não está registrado na base da Energisa
                  detail: O medidor 123456 não foi encontrado na base de dados da empresa EMR
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            CompanyNotFound:
              summary: Company not found
              value:
                error:
                  code: COMPANY_NOT_FOUND
                  message: Empresa não encontrada
                  detail: A empresa com o código fornecido não existe
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            CustomerNotFound:
              summary: Customer (UC) not found
              value:
                error:
                  code: CUSTOMER_NOT_FOUND
                  message: Cliente (UC) não encontrado
                  detail: O cliente com a UC fornecida não foi encontrado no sistema
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            MeterNotRegistered:
              summary: Meter not registered in Energisa database
              value:
                error:
                  code: METER_NOT_REGISTERED
                  message: Medidor não está registrado na base da Energisa
                  detail: O medidor 123456 não foi encontrado na base de dados da empresa EMR
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            CompanyNotFound:
              summary: Company not found
              value:
                error:
                  code: COMPANY_NOT_FOUND
                  message: Empresa não encontrada
                  detail: A empresa com o código fornecido não existe
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            CustomerNotFound:
              summary: Customer (UC) not found
              value:
                error:
                  code: CUSTOMER_NOT_FOUND
                  message: Cliente (UC) não encontrado
                  detail: O cliente com a UC fornecida não foi encontrado no sistema
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            RechargeNotFound:
              summary: Recharge not found (recharge-status endpoint)
              value:
                error:
                  code: RECHARGE_NOT_FOUND
                  message: Recarga não encontrada
                  detail: A recarga com msgId fornecido não existe nos registros da Energisa
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            UuidNotFound:
              summary: UUID not found (session endpoint)
              value:
                error:
                  code: UUID_NOT_FOUND
                  message: UUID não encontrado
                  detail: Não existe uma sessão associada ao UUID fornecido
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
    Conflict:
      description: Conflict with current state of the resource
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            DuplicateNotification:
              summary: Duplicate notification (low-balance endpoint)
              value:
                error:
                  code: DUPLICATE_NOTIFICATION
                  message: Notificação duplicada
                  detail: Já existe uma notificação para este medidor com o mesmo timestamp e alertType
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            DuplicateStatusNotification:
              summary: Duplicate status notification (recharge-status endpoint)
              value:
                error:
                  code: DUPLICATE_STATUS_NOTIFICATION
                  message: Notificação de status já recebida
                  detail: Uma notificação de status já foi recebida para esta recarga
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
            RechargeAlreadyCompleted:
              summary: Recharge already completed (recharge-status endpoint)
              value:
                error:
                  code: RECHARGE_ALREADY_COMPLETED
                  message: Recarga já foi completada
                  detail: O status desta recarga já foi registrado anteriormente como concluída
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
    Gone:
      description: Gone - resource existed but is no longer available (expired)
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            UuidExpired:
              summary: UUID expired (session endpoint)
              value:
                error:
                  code: UUID_EXPIRED
                  message: UUID expirado
                  detail: A sessão associada a este UUID expirou. O tempo de validade é de 5 minutos
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: false
    GatewayTimeout:
      description: Gateway Timeout - upstream service did not respond in time
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            NotificationProcessingTimeout:
              summary: Timeout processing notification
              value:
                error:
                  code: NOTIFICATION_PROCESSING_TIMEOUT
                  message: Timeout ao processar notificação
                  detail: O sistema não conseguiu processar a notificação dentro do tempo limite
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: true
            DatabaseTimeout:
              summary: Database timeout
              value:
                error:
                  code: DATABASE_TIMEOUT
                  message: Timeout ao acessar banco de dados
                  detail: O banco de dados da empresa não respondeu dentro do tempo limite
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: true
            SmsServiceTimeout:
              summary: SMS service timeout (low-balance endpoint)
              value:
                error:
                  code: SMS_SERVICE_TIMEOUT
                  message: Timeout ao enviar SMS/notificação ao cliente
                  detail: O serviço de SMS não respondeu dentro do tempo limite
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: true
            CustomerNotificationTimeout:
              summary: Customer notification timeout (recharge-status endpoint)
              value:
                error:
                  code: CUSTOMER_NOTIFICATION_TIMEOUT
                  message: Timeout ao notificar cliente
                  detail: Não foi possível notificar o cliente sobre o resultado da recarga dentro do tempo limite
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: true
    InternalServerError:
      description: Internal Server Error. An unexpected error occurred on the server.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            InternalError:
              summary: Generic internal server error
              value:
                error:
                  code: INTERNAL_ERROR
                  message: Erro interno do servidor
                  detail: Ocorreu um erro inesperado ao processar a requisição
                  timestamp: "2025-10-06T14:30:00Z"
                  retryable: true

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "Enter your JWT Bearer token in the format: Bearer <token>"
    BasicAuth:
      type: http
      scheme: basic
      description: |-
        Autenticação Basic usando client_id e client_secret.

        O header Authorization deve conter: Basic base64(client_id:client_secret)

  parameters:
    AuthClientId:
      name: client_id
      in: header
      description: Client ID for API authentication
      required: true
      schema:
        type: string
    AuthAccessToken:
      name: access_token
      in: header
      description: Access token for API authentication (from oauth/access-token)
      required: true
      schema:
        type: string
    VersionPathParam:
      name: version
      in: path
      description: API version
      required: true
      example: "2.0"
      schema:
        type: string
    CompanyId:
      name: companyId
      in: path
      required: true
      description: Energisa Company Identifier
      schema:
        type: string
        enum: [EMR, ESE, EPB, ETO, EMT, EMS, ESS, EAC, ERO]

servers:
  - url: https://hml-api.energisa.io
    description: Stagging Environment
  - url: https://api.energisa.io
    description: Prodcution Environment
  - url: https://hml-apis.energisa.io
    description: Stagging Environment with mTLS
  - url: https://apis.energisa.io
    description: Prodocution Environment with mTLS
security: []
